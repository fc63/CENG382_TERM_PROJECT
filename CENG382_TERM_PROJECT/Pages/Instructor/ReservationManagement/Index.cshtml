@page
@model CENG382_TERM_PROJECT.Pages.Instructor.ReservationManagement.IndexModel
@{
    ViewData["Title"] = "Haftalık Rezervasyon";
    Layout = "_Layout";
}

<h2 class="mb-4">Dönemlik Haftalık Rezervasyon</h2>

@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger">
        @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
        {
            <p>@error.ErrorMessage</p>
        }
    </div>
}

<form method="post" class="mb-5">
    <div class="mb-3">
        <label class="form-label">Sınıf Seçin</label>
        <select name="SelectedClassroomId" class="form-select" required>
            <option value="">-- Sınıf Seçin --</option>
            @foreach (var classroom in Model.AvailableClassrooms)
            {
                <option value="@classroom.Id">@classroom.Name - @classroom.Location</option>
            }
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Dönem Seçin</label>
        <select name="SelectedTermId" class="form-select" required>
            <option value="">-- Dönem Seçin --</option>
            @foreach (var term in Model.AvailableTerms)
            {
                <option value="@term.Id">@term.Name (@term.StartDate.ToShortDateString() - @term.EndDate.ToShortDateString())</option>
            }
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Haftalık Saatleri Seçin</label>
        <div class="table-responsive">
            <table class="table table-bordered text-center align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Saat</th>
                        @foreach (var day in new[] { "Monday", "Tuesday", "Wednesday", "Thursday", "Friday" })
                        {
                            <th>@day</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var hour in Model.AllTimeSlots.Select(t => t.StartTime).Distinct())
                    {
                        <tr>
                            <td>@hour.ToString("hh\\:mm")</td>
                            @foreach (var day in new[] { "Monday", "Tuesday", "Wednesday", "Thursday", "Friday" })
                            {
                                var slot = Model.AllTimeSlots.FirstOrDefault(ts => ts.DayOfWeek == day && ts.StartTime == hour);
                                <td>
                                    @if (slot != null)
                                    {
                                        <input type="checkbox" name="SelectedTimeSlotIds" value="@slot.Id" />
                                    }
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <button type="submit" class="btn btn-primary">Rezervasyon Gönder</button>
</form>

<h4>Mevcut Rezervasyonlarım</h4>
@if (Model.MyReservations.Any())
{
    <ul class="list-group">
        @foreach (var r in Model.MyReservations)
        {
            <li class="list-group-item">
                @r.Term.Name - @r.Classroom.Name, @r.TimeSlot.DayOfWeek @r.TimeSlot.StartTime.ToString("hh\\:mm")
                <span class="badge @(r.Status == "Pending" ? "bg-warning text-dark" : r.Status == "Approved" ? "bg-success" : "bg-danger")">@r.Status</span>
            </li>
        }
    </ul>
}
else
{
    <p>Henüz rezervasyon yapılmamış.</p>
}
